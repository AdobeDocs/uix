"use strict";(self.webpackChunk_adobe_uix_docs=self.webpackChunk_adobe_uix_docs||[]).push([[1986],{98128:function(e,n,o){o.r(n),o.d(n,{_frontmatter:function(){return l},default:function(){return p}});var t=o(87462),a=o(45987),i=(o(15007),o(64983)),s=o(91515);const r=["components"],l={},m={_frontmatter:l},d=s.Z;function p(e){let{components:n}=e,o=(0,a.Z)(e,r);return(0,i.mdx)(d,(0,t.Z)({},m,o,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"universal-editor-custom-asset-picker"},"Universal Editor Custom Asset Picker"),(0,i.mdx)("p",null,"This extension allows creating a configurable, custom asset picker for Universal Editor that is tailored to your need by simply providing a JSON configuration file. Relevant crosswalk project needs to follow certain guidelines.\nIt's useful in case where we want to enable authors to select assets of certain file types only from specified repositories etc."),(0,i.mdx)("h2",{id:"extension-overview"},"Extension Overview"),(0,i.mdx)("p",null,(0,i.mdx)("img",{parentName:"p",src:"/uix/assets/64b279332d31adfc84d6c931c06bb1a4/asset-picker-extension.gif",alt:"Asset picker"})),(0,i.mdx)("p",null,"This extension enhances ",(0,i.mdx)("a",{parentName:"p",href:"../../../services/aem-universal-editor/"},"Universal Editor")," properties panel for media elements. It replaces standard asset picker with a custom version of asset picker, with provided configuration applied while selecting assets."),(0,i.mdx)("p",null,"The extension will enable you to list the repositories your authors will be able to pick from."),(0,i.mdx)("p",null,"Configuration also supports following types of filters:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"File type (Images, Video etc.)"),(0,i.mdx)("li",{parentName:"ul"},"Repository type (author, delivery)")),(0,i.mdx)("h2",{id:"configuration-in-edge-delivery-site"},"Configuration in Edge Delivery Site"),(0,i.mdx)("p",null,"Adding a component for author in crosswalk site is like adding any other custom component, with some added fields. A sample custom component's definition requires updates in ",(0,i.mdx)("inlineCode",{parentName:"p"},"component-model.json")," and a new ",(0,i.mdx)("inlineCode",{parentName:"p"},"component-definition.json"),". See examples below:"),(0,i.mdx)("h3",{id:"a-new-component-model-in-component-modelsjson"},"A new Component Model in ",(0,i.mdx)("inlineCode",{parentName:"h3"},"component-models.json")),(0,i.mdx)("p",null,"This model is necessary for Universal Editor to use the Custom Asset Picker."),(0,i.mdx)("p",null,"For assets hosted in AEM Assets, the component model can be configured to use ",(0,i.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/en/docs/experience-manager-cloud-service/content/assets/dynamicmedia/dynamic-media-open-apis/dynamic-media-open-apis-overview"},"Dynamic Media with OpenAPI capabilities")," via ",(0,i.mdx)("a",{parentName:"p",href:"https://www.aem.live/docs/media#approach-b-asset-management-delivery"},"URL references"),", or ",(0,i.mdx)("a",{parentName:"p",href:"https://www.aem.live/docs/media#approach-a-built-in-media-bus-delivery"},"Edge Delivery Media Bus"),"."),(0,i.mdx)("h4",{id:"configure-component-modelsjson-to-leverage-dynamic-media-with-openapi-delivery"},"Configure ",(0,i.mdx)("inlineCode",{parentName:"h4"},"component-models.json")," to leverage Dynamic Media with OpenAPI Delivery"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'[\n...\n    {\n        "id": "custom-asset-one",\n        "fields": [\n          {\n            "component": "custom-asset-namespace:custom-asset",\n            "name": "image",\n            "label": "Image",\n            "configUrl": "https://main--xwalk-test-gems--githubusername.aem.page/tools/assets-selector/image.config.json",\n            "valueType": "string"\n          },\n          {\n            "component": "text",\n            "name": "imageTitle",\n            "label": "Alt Text",\n            "valueType": "string"\n          }\n        ]\n      }\n]\n')),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"id"),": can be any value. In the example above it is called ",(0,i.mdx)("inlineCode",{parentName:"li"},"custom-asset-one"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},'fields[name="image"].component'),": MUST have ",(0,i.mdx)("inlineCode",{parentName:"li"},"custom-asset-namespace:custom-asset")," as value, because it has been overridden in the extension to display customized asset selector popup."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},'fields[name="image"].configUrl'),": points to JSON configuration file, can be hosted anywhere you prefer. Must be accessible to the extension, which runs in author's web browser. It can be hosted on same AEM environment as well and relative path (for example ",(0,i.mdx)("inlineCode",{parentName:"li"},"/content/dam/assets/asset-selector.json"),") can be used. Extension will fetch this JSON file and configure asset picker for this component accordingly."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},'fields[name="imageTitle"]'),": Optional. For Dynamic Media delivery, anchor tag is being generated in the markup. To add alt text for such images in the markup, title property of the anchor tag can be leveraged. For assets not using Dynamic Media with Open API delivery, the regular picture element property i.e ",(0,i.mdx)("inlineCode",{parentName:"li"},"imageAlt")," should be used.")),(0,i.mdx)("h4",{id:"configure-component-modelsjson-to-leverage-edge-delivery-media-bus"},"Configure ",(0,i.mdx)("inlineCode",{parentName:"h4"},"component-models.json")," to leverage Edge Delivery Media Bus"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'[\n    {\n        "id": "custom-asset-one",\n        "fields": [\n          {\n            "name": "image",\n            "component": "custom-asset-namespace:custom-asset",\n            "label": "Image",\n            "configUrl": "https://main--xwalk-test-gems--githubusername.aem.page/tools/assets-selector/image.config.json",\n            "valueType": "string"\n          },\n          {\n            "name": "imageMimeType",\n            "component": "custom-asset-namespace:custom-asset-mimetype",\n            "valueType": "string"\n          },\n          {\n            "name": "imageAlt",\n            "label": "Alt Text",\n            "component": "text",\n            "valueType": "string"\n          }\n        ]\n    }\n]\n')),(0,i.mdx)("p",null,"In addition to the component model definition for Dynamic Media with OpenAPI Delivery, an opt-in component definition for ",(0,i.mdx)("inlineCode",{parentName:"p"},"imageMimeType")," ensures that the Edge Delivery Media Bus is used for media delivery."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},'fields[name="imageMimeType"].component'),": MUST have ",(0,i.mdx)("inlineCode",{parentName:"li"},"custom-asset-namespace:custom-asset-mimetype")," as value, it has been overridden in the extension to contain selected asset MIME Type. If mime type is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"image/*")," or for relative paths that resolve to an asset in AEM and is known to be an image, the asset is rendered using edge delivery services. If the mime type is missing, the generated markup will contain an anchor tag with Dynamic Media with OpenAPI delivery URL.")),(0,i.mdx)("h3",{id:"a-new-definition-in-component-definitionjson"},"A New Definition in ",(0,i.mdx)("inlineCode",{parentName:"h3"},"component-definition.json")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'{\n  "groups": [\n    …\n    {\n      "title": "Blocks",\n      "id": "blocks",\n      "components": [\n       …\n        {\n          "title": "Custom Image One",\n          "id": "custom-asset-one",\n          "plugins": {\n            "xwalk": {\n              "page": {\n                "resourceType": "core/franklin/components/block/v1/block",\n                "template": {\n                  "name": "Custom Image One",\n                  "model": "custom-asset-one"\n                }\n              }\n            }\n          }\n        }\n      ]\n    }\n  ]\n}\n')),(0,i.mdx)("p",null,"Note that the value of model is the id of model we created in ",(0,i.mdx)("inlineCode",{parentName:"p"},"component-models.json")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"title")," will show up as component name in ",(0,i.mdx)("inlineCode",{parentName:"li"},"➕")," (add component) button menu present on right side panel of universal editor.")),(0,i.mdx)("h2",{id:"entry-in-component-filtersjson"},"Entry in ",(0,i.mdx)("inlineCode",{parentName:"h2"},"component-filters.json")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'[\n  …\n  {\n    "id": "section",\n    "components": [\n      "text",\n      "image",\n      "button",\n      …\n      "custom-asset-one"\n    ]\n  }\n]\n')),(0,i.mdx)("h2",{id:"overriding-name-of-component-for-using-custom-asset-picker"},"Overriding name of component for using custom asset picker"),(0,i.mdx)("p",null,"in ",(0,i.mdx)("inlineCode",{parentName:"p"},"component-models.json")," file, the component property need to have component as ",(0,i.mdx)("inlineCode",{parentName:"p"},"custom-asset-namespace:custom-asset")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"custom-asset-namespace:custom-asset-mimetype"),".\nIf desired, this can be overridden by following method: "),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"https://developer.adobe.com/uix/docs/extension-manager/feature-highlights/#configuring-extension-parameters"},"Adding a parameter in extension configuration")," with key as ",(0,i.mdx)("inlineCode",{parentName:"li"},"asset-namespace")," and any desired value (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"my-namespace"),"). "),(0,i.mdx)("li",{parentName:"ul"},"Use ",(0,i.mdx)("inlineCode",{parentName:"li"},"my-namespace:custom-asset")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"my-namespace:custom-asset-mimetype")," instead of above values in ",(0,i.mdx)("inlineCode",{parentName:"li"},"component-models.json"),".")),(0,i.mdx)("h2",{id:"configuration-file"},"Configuration File"),(0,i.mdx)("p",null,"This is sample asset picker configuration file that allows filtering assets. Following are the fields that can be configured:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"repoNames"),": List of AEM environments from which assets can be picked. These will show up in the selector dropdown."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"aemTierType"),": It allows you to select whether you want to show assets from delivery tier, author tier, or both."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"expiryOptions"),": It allows you to select whether you want enable/disable expired assets to be selected in the asset selector."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"filterSchema"),": List of filters that can be applied when the asset selector is rendered."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"filterSchemaMapping"),": It allows to apply different filter schemas to different repositories."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rootPath"),": It allows definining rootpath from where the assets would be shown. Its applicable for author view. If this config is unset then default is Assets ROOT i.e. content/dam"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"assetDomainMapping"),": It allows mapping between repo name and its corresponding custom assets delivery domain."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"alwaysUseDMDelivery"),": If this configuration is set to true, the Delivery URL will be returned even when the Author repository is selected, provided that a corresponding Delivery repository is enabled for that Author repository.")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'{\n    "repoNames": [\n      "author-pxxxxxx-eyyyyyy.adobeaemcloud.com",\n      "delivery-pxxxxxx-eyyyyyy.adobeaemcloud.com",\n    ],\n   "aemTierType": [\n        "delivery",\n        "author"\n    ],\n    "expiryOptions": {\n        "allowSelectionAndDrag": false,\n    },\n    "filterSchema": [\n        {\n          "fields": [\n            {\n              "defaultValue": ["image/*"],\n              "element": "checkbox",\n              "name": "type",\n              "options": [\n                {\n                  "label": "Image",\n                  "readOnly": true,\n                  "value": "image/*"\n                }\n              ]\n            }\n          ],\n          "groupKey": "FileTypeGroup",\n          "header": "File Type"\n        },\n        {\n          "fields": [\n            {\n              "columns": 3,\n              "defaultValue": ["arena"],\n              "element": "taggroup",\n              "name": "property=xcm:keywords.id=",\n              "options": [\n                {\n                  "label": "Demo",\n                  "value": "demo"\n                }\n              ]\n            }\n          ],\n          "groupKey": "AssetTagsGroup",\n          "header": "Assets Tags"\n        }\n      ],\n    "filterSchemaMapping": {\n      "author-pxxxxxx-eyyyyyy.adobeaemcloud.com": [\n        {\n          "fields": [\n            {\n              "defaultValue": ["image/*"],\n              "element": "checkbox",\n              "name": "type",\n              "options": [\n                {\n                  "label": "Image",\n                  "readOnly": true,\n                  "value": "image/*"\n                }\n              ]\n            }\n          ],\n          "groupKey": "FileTypeGroup",\n          "header": "File Type"\n        },\n        {\n          "fields": [\n            {\n              "defaultValue": ["dam:assetStatus==approved"],\n              "element": "radiogroup",\n              "name": "property",\n              "options": [\n                {\n                  "label": "Approved",\n                  "value": "dam:assetStatus==approved"\n                }\n              ],\n              "readOnly": true\n            }\n          ],\n          "groupKey": "StatusGroup",\n          "header": "Approval Status"\n        },\n        {\n          "fields": [\n            {\n              "columns": 3,\n              "defaultValue": ["arena"],\n              "element": "taggroup",\n              "name": "property=xcm:keywords.id=",\n              "options": [\n                {\n                  "label": "arena",\n                  "value": "arena"\n                }\n              ]\n            }\n          ],\n          "groupKey": "AssetTagsGroup",\n          "header": "Assets Tags"\n        }\n      ],\n      "author-pxxxxxx-eyyyyyy.adobeaemcloud.com": []\n    },\n    "alwaysUseDMDelivery": true,\n    "assetDomainMapping": {\n          "delivery-pxxxxxx-eyyyyyy.adobeaemcloud.com":"mediapreprod.store.testdomain.com",\n        "delivery-pxxxxxx-eyyyyyy.adobeaemcloud.com": "media.store.testdomain.com",\n        "delivery-pxxxxxx-eyyyyyy.adobeaemcloud.com": "mediauat.store.testdomain.com"\n        "delivery-pxxxxxx-eyyyyyy.adobeaemcloud.com": "mediaqa.store.testdomain.com"\n      },\n    "rootPath": "/content/dam"\n}\n')),(0,i.mdx)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,i.mdx)("h3",{id:"cors-issues"},"CORS Issues"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Problem:"),"\nThe Asset Selector doesn't behave as configured (missing filters, unexpected AEM repositories, undesirable selection actions, etc. - essentially any/everything defined in ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/uix/docs/extension-manager/extension-developed-by-adobe/configurable-asset-picker/#configuration-file"},"this configuration file")," not be honored)"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Diagnosis:"),"\nThe most common issue behind the behaviour above is (CORS)","[https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS/Errors]"," (Cross-Origin Resource Sharing) errors when fetching the configuration file."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"When to check for CORS errors:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"The configuration is not being applied correctly"),(0,i.mdx)("li",{parentName:"ul"},"You see network errors in the browser console when the extension tries to load")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"How to identify CORS errors:")),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},"Open your browser's Developer Tools (F12)"),(0,i.mdx)("li",{parentName:"ol"},"Check the Console tab for errors like:",(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"Access to fetch at '...' from origin '...' has been blocked by CORS policy")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"No 'Access-Control-Allow-Origin' header is present on the requested resource"))))),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Common Causes:")),(0,i.mdx)("p",null,"Configuration files hosted on third-party domains (from the perspective of ",(0,i.mdx)("inlineCode",{parentName:"p"},"experience.adobe.com")," where Universal Editor runs) may trigger CORS errors."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Sample Use Case - Resolving CORS for EDS-hosted Configuration:")),(0,i.mdx)("p",null,"If your configuration file is being served from an Edge Delivery Services (EDS) site with ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.aem.page")," domain (e.g., ",(0,i.mdx)("inlineCode",{parentName:"p"},"https://main--xwalk-test-gems--githubusername.aem.page/tools/assets-selector/image.config.json"),"), you need to add the appropriate CORS headers to allow the Universal Editor to fetch the configuration."),(0,i.mdx)("p",null,"Add the ","[required headers]"," (",(0,i.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Allow-Origin"},"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Allow-Origin"),") to your EDS site by following the instructions in the ",(0,i.mdx)("a",{parentName:"p",href:"https://www.aem.live/docs/custom-headers"},"AEM Custom HTTP Response Headers documentation"),"."),(0,i.mdx)("p",null,"Issue the following ",(0,i.mdx)("inlineCode",{parentName:"p"},"curl")," and note the presence of ",(0,i.mdx)("inlineCode",{parentName:"p"},"Access-Control-Allow-Origin: https://experience.adobe.com")," in the ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Allow-Origin"},"response headers"),". e.g., if the ",(0,i.mdx)("inlineCode",{parentName:"p"},"configUrl")," is ",(0,i.mdx)("a",{parentName:"p",href:"https://main--xwalk-test-gems--githubusername.aem.page/tools/assets-selector/image.config.json"},"https://main--xwalk-test-gems--githubusername.aem.page/tools/assets-selector/image.config.json"),", the execution of the command below on a terminal-window should look like:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"# curl -sD- 'https://main--xwalk-test-gems--githubusername.aem.page/tools/assets-selector/image.config.json' | grep -i \"access-control\"\naccess-control-allow-origin: https://experience.adobe.com\n")),(0,i.mdx)("h2",{id:"limitations"},"Limitations"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"This custom asset picker can only be opened by clicking on selector in its properties panel. Unlike default asset picker, we can't click the asset to open it.")))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-extension-manager-extension-developed-by-adobe-configurable-asset-picker-index-md-46607e9653152b5a1098.js.map